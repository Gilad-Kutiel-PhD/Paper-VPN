In this section we consider the problem when the physical network is undirected.
Once again we seek to embed a virtual $\sigma\tau$-path 
into a simple physical $st$-path.
Note, that we still assume that the virtual graph is a DAG. 
We extend our algorithm to work for this case as well.

Recall that the problem on general graphs cannot be approximate at all,
thus we assume in this section that there exists an optimal embedding that uses
a physical path with at most $k$ \emph{heavy} vertices, thus are vertices with
degree greater than two (we do not assume anything about the physical network).
The modified algorithm includes a preprocessing stage that applies
random orientation to the physical network, the entire algorithm runs in
$O(t(n)k!)$, where $t(n)$ is the time it takes to compute the optimal embedding when the
physical network is a DAG, and finds the optimal embedding with high
probability.

The preprocessing stage is as follow:
let $V_h$ be the set of heavy vertices, and let 
$\pi:V_h \to [|V_h|]$ be a random permutation.
For every \emph{light path} $w_1, \ldots, w_l$, that is, $w_1, w_l \in
V_h$, $\pi(w_1) < \pi(w_l)$, and $\forall_{1 < i < l}, w_i \notin V_h$,
we direct the edges from $w_1$ to $w_l$ i.e. $w_i \to w_{i+1}$ for every $1
\leq i \leq l - 1$.
One can verifies that this can be done efficiently and that when this process
terminates $G$ is a DAG, Figure~\ref{fig:orientation} depicts the preprocessing
stage.

\begin{figure}[ht]
\input{fig-orientation}
\caption{
\label{fig:orientation}
The preprocessing stage: on the left is the undirected physical network,
Only the heavy nodes are drawn.
The numbers represent the permutation and the blue, dashed path represents a
path of an optimal embedding.
On the right side is the orientated physical network, 
note that it is enough that the internal ordering of the nodes on the blue,
dashed path is "correct" to ensure that the algorithm finds the optimal
embedding. }
\end{figure}

Completing the orientation, we use our previous algorithm to find an optimal
embedding.
We repeat this process, each time with a new independent random permutation, and
keep the best embedding so far.
Note that if there is an optimal embedding using a physical path with at most
$k$ heavy vertices then it is sufficient that those vertices are ordered
"correctly" w.r.t $\pi$, regardless of the order $\pi$ applies to all other
heavy vertices, to ensure that the algorithm finds the optimal embedding.
We claim that with high probability, 
after $O(k!)$ iterations, the above algorithm finds the optimal embedding, formally:

\begin{theorem}
With probability at least $1 - e^{-x}$ the algorithm finds the optimal embedding
after $xk!$ iterations.
\end{theorem}

\begin{proof}
Consider an optimal embedding and the order it induces on the heavy vertices in
the physical path (at most $k$ such vertices), if the random permutation orders
the heavy vertices correctly, i.e. in that order, we are guaranteed to find the
optimal embedding.
This happens with probability $1/k!$ and the probability to miss the optimal
embedding after $xk!$ iterations is $1 - (1 - 1/k!)^{xk!} \leq 1 - e^{-x}$.
\end{proof}
