We now consider the \VPN{} problem with latency.
Recall that in this variant of the problem we are also given a latency function
$l : E \times \calE \to \R$, and a latency constraint $L$.
The goal is to find a minimum cost embedding that also respect the latency
constraint.

We first describe an algorithm that, given a cost constraint $c$, 
finds an embedding that costs at most $c$ and has the minimum possible latency.
Once again, the algorithm maintains a pair of physical and virtual nodes,
$\gamma$ and $w$ respectively.
In each step it chooses a virtual edge $\alpha\beta$ and a physical node $v$
that are ascendant of $\gamma$ and $w$ respectively.
It then finds a $vw$-path that support the bandwidth of $\alpha\beta$ and
has the minimum possible latency with respect to this edge.
It also finds $\beta\gamma$-path that can be embedded into $w$ and has the 
minimum possible cost.
Finally it finds an embedding of a $\sigma\alpha$-path into a $sv$-path with 
the minimum possible latency recursively.

Let $L(\sigma-\gamma, s-w, c)$ denote an embedding of a $\sigma\gamma$-path
into a $sw$-path with the minimum possible latency that cost at most $c$.
Let $L_{b}(\alpha\beta, v-w)$ be the minimum possible latency on a $\alpha\beta$-path
w.r.t virtual edge $\alpha\beta$, using only edges with bandwidth capacity at least $b$,
i.e. if $P$ is the set of edges in this path then $\forall_{e \in P}~b(e) \geq b$,
and $\sum_{e \in P}l(\alpha\beta, e)$ is minimum.
Observe that the later can be reduced to a shortest path problem on $G$ by removing
edged with bandwidth less than $b$ and setting the weight of each edge $e$ to be 
$l(\alpha\beta, e)$.
Now $L(\sigma-\gamma, s-w, c)$ can be computed recursively as follow:
\begin{align*}
&L(\sigma-\gamma, s-w, c) = 
\min_{\substack{
\alpha\beta \in \calE,  
v \in V:
\\
\pi(v) < \pi(w),
\\
\pi(\beta ) < \pi(\gamma ), 
\\
r_{b(\alpha\beta)}(v,w)
}}
L_{b}(\alpha\beta, v-w) + 
L(\sigma-\alpha, s-v, c - C(\beta-\gamma, w))
\\
&L(\sigma-\sigma, s-v, \geq 0) = 0
\\
&L(\sigma-\alpha, s-s, \cdot) = \infty
\\
&L(\cdot, \cdot, <0) = \infty
\end{align*} 

Now, to compute the optimal embedding with the additional latency constraint,
$L$, one can simply (binary) search for the minimum value of $c$ such that
$L(\sigma-\tau, s-t, c) \leq L$.
