In this section, 
assuming costs are integral and polynomial bounded in the input length,
we present an efficient algorithm to the \VPN{} problem.
We then argue that, using a standard scaling and rounding technique, we can use
the same computation to achieve a solution with a cost only
$1 + \varepsilon$ times greater that of the optimal solution, for any
$\varepsilon > 0$, i.e. an FPTAS, for an arbitrary cost function.
It is a recursive algorithm that can be efficiently implemented using dynamic
programming.

We are given an instance of the \VPN{} problem 
\begin{align*}
\calG = (\calV, \calE)		\\
G = (V, E)		\\
(\sigma , \tau , s, t)	\\
(p, b, c)
\end{align*}
The algorithm maintains a pair of physical and virtual nodes,
$\gamma$ and $w$ respectively.
In each step it chooses a virtual edge $\alpha\beta$ and a physical node $v$
that are ascendant of $\gamma$ and $w$ respectively.
It then embeds a minimum cost $\beta\gamma$-path into $w$ 
without violating its processing capacity,
it also compute a $vw$-path to be used in the solution, 
making sure the path can carry the bandwidth demand of the edge $\beta\gamma$.
Finally it finds an optimal embedding to a $\sigma\alpha$-path into a $sv$-path 
recursively.
This informal description of the algorithm is illustrated in Figure~\ref{fig:dp1}.

\begin{figure}[ht]
\centering
\input{fig-dp2}
\caption[]{
\label{fig:dp1}
The optimal embedding of a $\sigma \gamma $-path into a $sw$-path can be
efficiently computed by breaking the problem into the problem of embedding 
a $\sigma\alpha$-path into a $sv$-path (blue, dashed clouds) 
and the problem of embedding a $\beta\gamma$-path into $w$ (orange, dotted).
The $vw$-path must carry $b(\alpha\beta)$ bandwidth, 
The $\beta\gamma$-path is a minimum cost $\beta\gamma$-path 
that can be embedded into $w$.
}
\end{figure}

We now give a more formal description of the algorithm.
Let $C(\sigma-\gamma , s-w)$ denote the
minimum cost embedding of a $\sigma\gamma $-path into a $sw$-path.
Let $\pi$ be a typological ordering 
(we use $\pi$ to denote a typological ordering of 
both the virtual and the physical graphs).
Also let $C(\beta-\gamma, w)$ be the minimum cost embedding of a $\beta\gamma$-path
into $w$, 
and let $r_b(v, w)$ be a predicate that is true if $w$ is reachable from $v$
using only edges with bandwidth at least $b$. 
We claim that $C$ can be computed recursively as follow:
\begin{align*}
&C(\sigma-\gamma , s-w) = 
\min_{\substack{
\alpha\beta \in \calE,  
v \in V:
\\
\pi(v) < \pi(w),
\\
\pi(\beta ) < \pi(\gamma ), 
\\
r_{b(\alpha\beta)}(v,w)
}}
C(\sigma-\alpha , s-v)
+
C(\beta-\gamma, w)
\\
&C(\sigma-\sigma , s-v) = 0
\\
&C(\sigma-\alpha , s-s) = \infty
\end{align*}
Computing $C(\sigma-\tau , s-t)$ gives the optimal embedding. 
It is clear that $r_b(v,w)$ can be computed efficiently by removing all the edges
with bandwidth less than $b$ and checking connectivity.
We now argue that $C(\beta-\gamma, w)$ can be computed efficiently as well.
Let $P_w(\alpha-\gamma, c)$ 
be the minimum processing required to embed a virtual, 
$\alpha\gamma$-path into $w$ with a cost constraint $c$, 
then $P$ can be computed recursively as follow:
\begin{align*}
&P_{w}(\alpha-\gamma, c) = 
\min_{\beta\gamma  \in \calE} P_{w}(\alpha-\beta, c - c(\gamma, w))
\\
&P_w(\alpha-\alpha, c) = 
\begin{cases}
p(\alpha) & c(\alpha, w) \leq c
\\
\infty & \text{otherwise}
\end{cases}
\\
&P(\cdot, \cdot, <0) = \infty
\end{align*}
To complete our argument observe that the following holds:
$$C(\beta-\gamma, w) = \smashoperator{\min_{c : P_w(\beta-\gamma, c) \leq p(w)}}c$$ 


