In this section, 
assuming costs are integral and polynomial bounded in the input length,
we present an efficient algorithm to the \VPN{} problem.
We then extend the algorithm to also obey a global latency constraint.
Finally, we argue that, using a standard scaling and rounding technique, we can use
the same computation to achieve a solution with a cost only
$1 + \varepsilon$ times greater that of the optimal solution, for any
$\varepsilon > 0$, i.e. an FPTAS, for an arbitrary cost function.
It is a recursive algorithm that can be efficiently implemented using dynamic
programming.

We are given an instance of the \VPN{} problem 
$
\calG = (\calV, \calE),
G = (V, E),
(\sigma , \tau , s, t),
(p, b, c)
$.
The algorithm maintains a pair of physical and virtual nodes,
$\gamma$ and $w$ respectively.
In each step it chooses a virtual edge $\alpha\beta$ and a physical node $v$
that are ascendant of $\gamma$ and $w$ respectively.
It then embeds a minimum cost $\beta\gamma$-path into $w$ 
without violating its processing capacity,
it also compute a $vw$-path to be used in the solution, 
making sure the path can carry the bandwidth demand of the edge $\beta\gamma$.
Finally it finds an optimal embedding to a $\sigma\alpha$-path into a $sv$-path 
recursively.
This informal description of the algorithm is illustrated in Figure~\ref{fig:dp1}.

\begin{figure}[ht]
\centering
\input{fig-dp2}
\caption[]{
\label{fig:dp1}
The optimal embedding of a $\sigma \gamma $-path into a $sw$-path can be
efficiently computed by breaking the problem into the problem of embedding 
a $\sigma\alpha$-path into a $sv$-path (blue, dashed rectangles) 
and the problem of embedding a $\beta\gamma$-path into $w$ (orange, dotted).
The $vw$-path must carry $b(\alpha\beta)$ bandwidth, 
The $\beta\gamma$-path is a minimum cost $\beta\gamma$-path 
that can be embedded into $w$.
}
\end{figure}

We now give a more formal description of the algorithm.
Let $C(\sigma-\gamma , s-w)$ denote the
minimum cost embedding of a $\sigma\gamma $-path into a $sw$-path.
Let $\pi$ be a typological ordering 
(we use $\pi$ to denote a typological ordering of 
both the virtual and the physical graphs).
Also let $C(\beta-\gamma, w)$ be the minimum cost embedding of a $\beta\gamma$-path
into $w$, 
and let $r_b(v, w)$ be a predicate that is true if $w$ is reachable from $v$
using only edges with bandwidth at least $b$. 
We claim that $C$ can be computed recursively as follow:
\begin{align*}
&C(\sigma-\gamma , s-w) = 
\min_{\substack{
\alpha\beta \in \calE,  
v \in V:
\\
\pi(v) < \pi(w),
\\
\pi(\beta ) < \pi(\gamma ), 
\\
r_{b(\alpha\beta)}(v,w)
}}
C(\sigma-\alpha , s-v)
+
C(\beta-\gamma, w)
\\
&C(\sigma-\sigma , s-v) = 0
\\
&C(\sigma-\alpha , s-s) = \infty
\end{align*}
Computing $C(\sigma-\tau , s-t)$ gives the optimal embedding. 
It is clear that $r_b(v,w)$ can be computed efficiently by removing all the edges
with bandwidth less than $b$ and checking connectivity.
We now argue that $C(\beta-\gamma, w)$ can be computed efficiently as well.
Let $P_w(\alpha-\gamma, c)$ 
be the minimum processing required to embed a virtual, 
$\alpha\gamma$-path into $w$ with a cost constraint $c$, 
then $P$ can be computed recursively as follow:
\begin{align*}
&P_{w}(\alpha-\gamma, c) = 
\min_{\beta\gamma  \in \calE} P_{w}(\alpha-\beta, c - c(\gamma, w))
\\
&P_w(\alpha-\alpha, c) = 
\begin{cases}
p(\alpha) & c(\alpha, w) \leq c
\\
\infty & \text{otherwise}
\end{cases}
\\
&P(\cdot, \cdot, <0) = \infty
\end{align*}
To complete our argument observe that the following holds:
$$C(\beta-\gamma, w) = \smashoperator{\min_{c : P_w(\beta-\gamma, c) \leq p(w)}}c$$ 

We now consider the \VPN{} problem with latency.
Recall that in this variant of the problem we are also given a latency function
$l : E \times \calE \to \R$, and a latency constraint $L$.
The goal is to find a minimum cost embedding that also respect the latency
constraint.

We first describe an algorithm that, given a cost constraint $c$, 
finds an embedding that costs at most $c$ and has the minimum possible latency.
Once again, the algorithm maintains a pair of physical and virtual nodes,
$\gamma$ and $w$ respectively.
In each step it chooses a virtual edge $\alpha\beta$ and a physical node $v$
that are ascendant of $\gamma$ and $w$ respectively.
It then finds a $vw$-path that support the bandwidth of $\alpha\beta$ and
has the minimum possible latency with respect to this edge.
It also finds $\beta\gamma$-path that can be embedded into $w$ and has the 
minimum possible cost.
Finally it finds an embedding of a $\sigma\alpha$-path into a $sv$-path with 
the minimum possible latency recursively.

Let $L(\sigma-\gamma, s-w, c)$ denote an embedding of a $\sigma\gamma$-path
into a $sw$-path with the minimum possible latency that cost at most $c$.
Let $L_{b}(\alpha\beta, v-w)$ be the minimum possible latency on a $\alpha\beta$-path
w.r.t virtual edge $\alpha\beta$, using only edges with bandwidth capacity at least $b$,
i.e. if $P$ is the set of edges in this path then $\forall_{e \in P}~b(e) \geq b$,
and $\sum_{e \in P}l(\alpha\beta, e)$ is minimum.
Observe that the later can be reduced to a shortest path problem on $G$ by removing
edged with bandwidth less than $b$ and setting the weight of each edge $e$ to be 
$l(\alpha\beta, e)$.
Now $L(\sigma-\gamma, s-w, c)$ can be computed recursively as follow:
\begin{align*}
&L(\sigma-\gamma, s-w, c) = 
\min_{\substack{
\alpha\beta \in \calE,  
v \in V:
\\
\pi(v) < \pi(w),
\\
\pi(\beta ) < \pi(\gamma ), 
\\
r_{b(\alpha\beta)}(v,w)
}}
L_{b}(\alpha\beta, v-w) + 
L(\sigma-\alpha, s-v, c - C(\beta-\gamma, w))
\\
&L(\sigma-\sigma, s-v, \geq 0) = 0
\\
&L(\sigma-\alpha, s-s, \cdot) = \infty
\\
&L(\cdot, \cdot, <0) = \infty
\end{align*} 

Now, to compute the optimal embedding with the additional latency constraint,
$L$, one can simply (binary) search for the minimum value of $c$ such that
$L(\sigma-\tau, s-t, c) \leq L$.

To conclude this section we show that for an arbitrary cost function, $c$,
and for any $\varepsilon > 0$ 
we can defined a scaled, rounded function $c'$ such that:
\begin{enumerate}
\item $OPT_{c'} \leq (1 + \varepsilon)OPT$, where $OPT_{c'}$ is the optimal
value w.r.t $c'$ and $OPT$ is the optimal value w.r.t $c$.
\item $\max_{\alpha, v : c'(\alpha, v) \neq \infty}c'(\alpha, v)$ is polynomial
bounded in the size of the input.
\end{enumerate}
Combining the above with the algorithms described earlier 
yields FPTAS for the \VPN{} problem for an arbitrary cost function.

Let $\hat{c}$ be the maximum cost incurs by embedding a single virtual node into 
a physical node in an optimal embedding, 
that is $\hat{c} \eqdf \max_{\alpha \in \calV}c(\alpha, f_{opt}(\alpha))$.
Given $\varepsilon$ we define 
$$
c'(\alpha, v) \eqdf
\begin{cases}
\ceil{c(\alpha, v)/\mu} & c(\alpha, v) \leq \hat{c}
\\
\infty & c(\alpha, v) > \hat{c}
\end{cases}
$$
where 
$
\mu \eqdf \frac{\hat{c}\varepsilon}{n}
$.
Let $s$ be an optimal placement w.r.t $c'$ 
and let $o$ be an optimal placement w.r.t $c$, 
let also $S$ and $O$ denotes their values respectively, then.
\begin{lemma}
S \leq (1 + \varepsilon)O
\end{lemma}
\begin{proof}
\begin{align*}
S = & \sum_{\alpha \in \calV}c(\alpha, s(\alpha)) \leq
\\&
\mu\sum_{\alpha \in \calV}c'(\alpha, s(\alpha)) \leq
\\&
\mu\sum_{\alpha \in \calV}c'(\alpha, o(\alpha)) \leq
\\&
\mu\sum_{\alpha \in \calV}c(\alpha, o(\alpha))/\mu + 1 \leq
\\&
\sum_{\alpha \in \calV}c(\alpha, o(\alpha)) + n\mu =
O + \hat{c}\varepsilon \leq (1 + \varepsilon)O
\end{align*}
\end{proof}
Clearly, $\hat{c}$, is not known in advanced, but one can "guess" 
its value as there are at most
$|\calV| \cdot |V|$ possible values to choose from.

